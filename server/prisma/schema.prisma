generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "sqlite"
    url      = "file:./database.db"
}

model Race {
    id   Int    @id @default(autoincrement())
    name String

    classifications Classification[]
    timeKeeper      TimingPoint[]
    player          Player[]
    splitTime       SplitTime[]
}

model Classification {
    id   Int    @id @default(autoincrement())
    name String

    race    Race     @relation(fields: [raceId], references: [id])
    raceId  Int
    players Player[]

    @@unique([raceId, name])
}

model Player {
    id             Int      @id @default(autoincrement())
    name           String
    lastName       String
    birthDate      DateTime
    gender         String
    bibNumber      Int?
    team           String?
    city           String?
    country        String?
    email          String?
    phoneNumber    String?
    icePhoneNumber String?

    race               Race           @relation(fields: [raceId], references: [id])
    raceId             Int
    classification     Classification @relation(fields: [classificationId], references: [id])
    classificationId   Int
    registeredBy       User           @relation(fields: [registeredByUserId], references: [id])
    registeredByUserId Int
    splitTime          SplitTime[]

    @@unique([raceId, bibNumber])
}

model User {
    id                Int      @id @default(autoincrement())
    login             String
    password          String
    registeredPlayers Player[]
}

model TimingPoint {
    id        Int         @id @default(autoincrement())
    name      String
    order     Int
    race      Race        @relation(fields: [raceId], references: [id])
    raceId    Int
    splitTime SplitTime[]

    @@unique([raceId, name])
}

model SplitTime {
    id        Int    @id @default(autoincrement())
    time      BigInt
    bibNumber Int

    race          Race        @relation(fields: [raceId], references: [id])
    raceId        Int
    timingPoint   TimingPoint @relation(fields: [timingPointId], references: [id])
    timingPointId Int
    player        Player?     @relation(fields: [raceId, bibNumber], references: [raceId, bibNumber])
}
